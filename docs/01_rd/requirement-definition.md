# 要件定義書

## 1. 概要

管理者のプロフィール、ブログを中心とした情報発信を行うための個人サイト。
将来的には写真展示ページなどの機能拡張を予定しているが、初期リリースではプロフィールページとブログページを主な機能とする。

## 2. 機能一覧

- トップページ
- プロフィールページ
- ブログページ
- 管理者ページ

## 3. デザイン要件

### 3.1. カラー構成

Tailwind CSSのカラーパレットを基準とする。

- **メインカラー:** `zinc-200`
- **サブカラー:** `yellow-300`
- **アクセントカラー:** `indigo-400`

## 4. ページ別詳細要件

### 4.1. トップページ

#### 4.1.1. ヘッダー (全ページ共通)

- **左側:**
    - ロゴアイコン: クリックでトップページに遷移する。
    - ナビゲーション: 各主要ページ（プロフィール、ブログ）へのリンクを配置する。
- **右側:**
    - プロフィールアイコン: クリックでプロフィールページに遷移する。

#### 4.1.2. メインコンテンツ

- ブログや写真ギャラリーなど、各コンテンツへの入り口となるタイルを配置する。
- タイルはジャンルごとにグルーピングして表示する。
- **デザイン:**
    - 全画面に広がるグリッドレイアウトを採用し、各タイルはカードとして表現する。
    - カードにはコンテンツの概要（例: ブログの最新記事タイトル、写真のサムネイル）を表示する。
    - マウスオーバー時にカードが少し浮き上がるようなインタラクションを追加し、立体感を演出する。
    - 詳細なデザインは次工程の基本設計で定義する。

### 4.2. プロフィールページ

- 管理者の名前、略歴、自己紹介文を掲載する。
- 管理者のX (旧Twitter) アカウントへのリンクアイコンを設置する。
- 全体的にシンプルで可読性の高いレイアウトとする。

### 4.3. ブログページ

#### 4.3.1. ブログ一覧

- 投稿されたブログ記事を一覧で表示する。
- **フィルタリング機能:**
    - カテゴリ（`子育て`, `ゲーム`, `スポーツ`, `雑談`）による絞り込み。
    - 執筆時期による絞り込み。サイドエリアに年/月ごとの記事数を表示し、クリックすることでフィルタリングする。年単位での折りたたみが可能。
      ```
      2025年
        - 10月 (5)
        -  8月 (4)
      2024年
        - 12月 (12)
      ```
- **並び替え機能:**
    - 執筆時期の「新しい順」「古い順」で並び替えが可能。

#### 4.3.2. ブログ詳細

- 記事本文はMarkdown形式で記述された内容をHTMLに変換して表示する。
- 記事内に画像を表示できる。
- 記事内にX (旧Twitter) のポストやYouTubeの動画を埋め込み表示できる。

### 4.4. 管理者ページ

#### 4.4.1. アクセスと認証

- `https://[domain]/admin` のURLに直接アクセスする。トップページからの導線は設けない。
- Googleアカウントを使用したOAuth 2.0 / OpenID Connectによるシングルサインオン（SSO）で認証を行う。

#### 4.4.2. 機能

- ブログ記事の新規作成、編集、削除（CRUD）が可能。
- **記事編集画面:**
    - 画面を左右に分割し、左側にMarkdownエディタ、右側にリアルタイムプレビューを表示する。
    - エディタへの画像のドラッグ＆ドロップ、またはファイル選択により画像を**Google Cloud Storage**にアップロードし、自動でMarkdownの画像リンクを生成・挿入する。
    - YouTubeなどの埋め込み用iframeをエディタに貼り付けることで、動画を埋め込み表示できる。

## 5. 非機能要件

### 5.1. 環境構成要件

#### 5.1.1. 環境一覧
- **本番環境:** Google Cloud Platform (GCP) 上に構築。
- **開発環境:** ローカルPC上にDockerを使用して構築。

#### 5.1.2. 本番環境
- **アプリケーション実行環境:** Cloud Run
- **コンテナレジストリ:** Artifact Registry
- **CI/CD:** Cloud BuildがArtifact Registryへのプッシュをトリガーとし、Cloud Runへ自動デプロイを行う。
- **データベース:** SQLite3。Cloud Storage FUSEを利用して、Cloud Storage上のデータベースファイルをコンテナにマウントして利用する。
- **ファイルストレージ:** Cloud Storage

#### 5.1.3. 開発環境
- **ランタイム:** anyenv/nodenvで管理されたNode.js
- **実行方法:** Docker Compose (`docker-compose.yaml`) を使用してコンテナを起動。
- **データベース:** ローカルの `data/` ディレクトリに配置したSQLite3データベースファイルを利用する。
- **ファイルストレージ:** ローカルの `data/` ディレクトリでCloud Storageの動作を代替する。このディレクトリはGitの管理対象外とする。

### 5.2. アプリケーション要件

- **Webフレームワーク:** Next.js (最新版)
- **データベースORM:** TypeORM
- **認証:** Identity Platform (Google Cloud)
- **静的解析・フォーマッター:** ESLint, Prettier
- **テストフレームワーク:** Jest, React Testing Library
- **コンポーネントテスト:** Storybook

### 5.3. CI/CD要件

- **ソースコード管理:** GitHub
- **CI/CDパイプライン:** GitHub Actions
- **CI (継続的インテグレーション):**
  - プルリクエストやmainブランチへのプッシュをトリガーに実行。
  - 静的解析 (ESLint) とテスト (Jest) を実行。
  - テストカバレッジ (Line, Statement, Branch, Function) を計測し、結果をレポートする。
- **CD (継続的デリバリー):**
  - mainブランチへのマージをトリガーに実行。
  - Next.jsアプリケーションをコンテナイメージとしてビルドし、Artifact Registryにプッシュする。
- **ドキュメント:**
  - `README.md`に開発環境のセットアップ手順を記載。
  - `README.md`にGitHub ActionsからGoogle Cloudへ認証するための設定手順を記載。